<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Mi Perfil - PetLuz</title>
    <link rel="stylesheet" th:href="@{/css/base_customer.css}">
    <link rel="stylesheet" th:href="@{/css/customer_profile.css}">
</head>

<body>
    <div th:replace="shared/header :: header"></div>
    <div th:replace="shared/cart-sidebar :: cart-sidebar"></div>

    <main class="profile-container">
        <div class="container">
            <section class="profile-header">
                <!-- Part√≠culas flotantes -->
                <div class="floating-particles">
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                </div>

                <div class="header-content">
                    <h1>Mi Perfil</h1>
                    <p>Gestiona tu informaci√≥n personal y preferencias</p>
                </div>
                <div class="profile-completion">
                    <div class="completion-info">
                        <span>Perfil completado al <strong id="completionPercent">0%</strong></span>
                        <div class="completion-bar">
                            <div class="completion-fill" id="completionBar"></div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="profile-layout">
                <!-- Sidebar de navegaci√≥n -->
                <aside class="profile-sidebar">
                    <nav class="sidebar-nav">
                        <button class="nav-item active" data-tab="personal-info">
                            <span class="nav-icon">üë§</span>
                            <span class="nav-text">Informaci√≥n Personal</span>
                        </button>
                        <button class="nav-item" data-tab="contact-info">
                            <span class="nav-icon">üìû</span>
                            <span class="nav-text">Informaci√≥n de Contacto</span>
                        </button>
                        <button class="nav-item" data-tab="preferences">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span class="nav-text">Preferencias</span>
                        </button>
                        <button class="nav-item" data-tab="security">
                            <span class="nav-icon">üîí</span>
                            <span class="nav-text">Seguridad</span>
                        </button>
                    </nav>
                </aside>

                <!-- Contenido principal -->
                <div class="profile-content">
                    <!-- Informaci√≥n Personal -->
                    <div class="tab-content active" id="personal-info-tab">
                        <div class="tab-header">
                            <h2>Informaci√≥n Personal</h2>
                            <p>Actualiza tu informaci√≥n b√°sica</p>
                        </div>

                        <form class="profile-form" id="personalInfoForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">Nombre *</label>
                                    <input type="text" id="firstName" name="firstName" required placeholder="Tu nombre"
                                        minlength="3" maxlength="50">
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Apellido *</label>
                                    <input type="text" id="lastName" name="lastName" required placeholder="Tu apellido"
                                        minlength="3" maxlength="50">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="displayName">Nombre para mostrar</label>
                                <input type="text" id="displayName" name="displayName" readonly
                                    placeholder="Como quieres que te llamemos" class="readonly-input">
                                <div class="input-note">Se genera autom√°ticamente desde nombre y apellido</div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="dateOfBirth">Fecha de Nacimiento</label>
                                    <input type="date" id="dateOfBirth" name="dateOfBirth">
                                </div>
                                <div class="form-group">
                                    <label for="gender">G√©nero</label>
                                    <select id="gender" name="gender">
                                        <option value="">Seleccionar...</option>
                                        <option value="MALE">Masculino</option>
                                        <option value="FEMALE">Femenino</option>
                                        <option value="OTHER">Otro</option>
                                        <option value="PREFER_NOT_TO_SAY">Prefiero no decir</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <span class="btn-text">Guardar Cambios</span>
                                    <span class="btn-loading" style="display: none;">‚åõ</span>
                                </button>
                                <button type="button" class="btn btn-secondary" id="resetPersonalBtn">
                                    Cancelar
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Informaci√≥n de Contacto -->
                    <div class="tab-content" id="contact-info-tab">
                        <div class="tab-header">
                            <h2>Informaci√≥n de Contacto</h2>
                            <p>Gestiona tus n√∫meros de contacto</p>
                        </div>

                        <form class="profile-form" id="contactInfoForm">
                            <div class="form-group">
                                <label for="email">Correo Electr√≥nico *</label>
                                <input type="email" id="email" name="email" readonly class="readonly-input">
                                <div class="input-note">El correo electr√≥nico no se puede modificar</div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="phone">Tel√©fono Principal *</label>
                                    <input type="tel" id="phone" name="phone" required placeholder="3001234567"
                                        pattern="[0-9]{10}" maxlength="10" title="10 d√≠gitos sin espacios">
                                </div>
                                <div class="form-group">
                                    <label for="alternatePhone">Tel√©fono Alternativo</label>
                                    <input type="tel" id="alternatePhone" name="alternatePhone" placeholder="Opcional"
                                        pattern="[0-9]{10}" maxlength="10" title="10 d√≠gitos sin espacios">
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <span class="btn-text">Guardar Cambios</span>
                                    <span class="btn-loading" style="display: none;">‚åõ</span>
                                </button>
                                <button type="button" class="btn btn-secondary" id="resetContactBtn">
                                    Cancelar
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Preferencias -->
                    <div class="tab-content" id="preferences-tab">
                        <div class="tab-header">
                            <h2>Preferencias</h2>
                            <p>Configura tus preferencias de comunicaci√≥n</p>
                        </div>

                        <form class="profile-form" id="preferencesForm">
                            <div class="preferences-list">
                                <div class="preference-item">
                                    <div class="preference-info">
                                        <h4>Notificaciones por Email</h4>
                                        <p>Recibir notificaciones sobre tus pedidos y promociones</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="emailNotifications" name="emailNotifications">
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="preference-item">
                                    <div class="preference-info">
                                        <h4>Notificaciones por SMS</h4>
                                        <p>Recibir notificaciones importantes por mensaje de texto</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="smsNotifications" name="smsNotifications">
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="preference-item">
                                    <div class="preference-info">
                                        <h4>Bolet√≠n Informativo</h4>
                                        <p>Recibir novedades y ofertas especiales</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="newsletterSubscription"
                                            name="newsletterSubscription">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <span class="btn-text">Guardar Preferencias</span>
                                    <span class="btn-loading" style="display: none;">‚åõ</span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Seguridad -->
                    <div class="tab-content" id="security-tab">
                        <div class="tab-header">
                            <h2>Seguridad</h2>
                            <p>Gestiona la seguridad de tu cuenta</p>
                        </div>

                        <div class="security-sections">
                            <!-- Cambio de contrase√±a -->
                            <section class="security-section">
                                <div class="section-header">
                                    <h3>Cambiar Contrase√±a</h3>
                                    <div class="section-icon">üîë</div>
                                </div>
                                <form class="security-form" id="changePasswordForm">
                                    <div class="form-group">
                                        <label for="currentPassword">Contrase√±a Actual</label>
                                        <input type="password" id="currentPassword" name="currentPassword" required
                                            placeholder="Ingresa tu contrase√±a actual">
                                    </div>
                                    <div class="form-group">
                                        <label for="newPassword">Nueva Contrase√±a</label>
                                        <input type="password" id="newPassword" name="newPassword" required
                                            minlength="8" placeholder="M√≠nimo 8 caracteres">
                                        <!-- Los requisitos de contrase√±a se generan autom√°ticamente -->
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmPassword">Confirmar Nueva Contrase√±a</label>
                                        <input type="password" id="confirmPassword" name="confirmPassword" required
                                            placeholder="Repite la nueva contrase√±a">
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <span class="btn-text">Cambiar Contrase√±a</span>
                                        <span class="btn-loading" style="display: none;">‚åõ</span>
                                    </button>
                                </form>
                            </section>

                            <!-- Foto de perfil -->
                            <section class="security-section">
                                <div class="section-header">
                                    <h3>Foto de Perfil</h3>
                                    <div class="section-icon">üñºÔ∏è</div>
                                </div>
                                <div class="profile-picture-section">
                                    <div class="current-avatar">
                                        <img id="currentProfilePicture" src="/images/default-avatar.png"
                                            alt="Foto de perfil actual">
                                        <div class="avatar-overlay">
                                            <span class="edit-icon">‚úèÔ∏è</span>
                                        </div>
                                    </div>
                                    <div class="avatar-actions">
                                        <form id="profilePictureForm" enctype="multipart/form-data">
                                            <input type="file" id="profilePictureFile" name="file" accept="image/*"
                                                class="file-input">
                                            <button type="button" class="btn btn-secondary" id="changePictureBtn">
                                                Cambiar Foto
                                            </button>
                                            <button type="button" class="btn btn-outline" id="deletePictureBtn">
                                                Eliminar Foto
                                            </button>
                                        </form>
                                        <p class="help-text">Formatos: JPG, PNG, GIF. M√°x: 10MB</p>
                                    </div>
                                </div>
                            </section>

                            <!-- Informaci√≥n de seguridad -->
                            <section class="security-section">
                                <div class="section-header">
                                    <h3>Informaci√≥n de Seguridad</h3>
                                    <div class="section-icon">üìä</div>
                                </div>
                                <div class="security-info">
                                    <div class="info-item">
                                        <span class="info-label">Cuenta creada:</span>
                                        <span id="accountCreatedInfo" class="info-value">Cargando...</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Estado de la cuenta:</span>
                                        <span class="status-badge verified">
                                            <span class="status-dot"></span>
                                            Activa
                                        </span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Verificaci√≥n de email:</span>
                                        <span class="status-badge verified">
                                            <span class="status-dot"></span>
                                            Verificado
                                        </span>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="shared/footer :: footer-pedLUz"></div>
    <div id="notificationContainer"></div>

    <script>
        // Forzar actualizaci√≥n del carrito cuando se carga estas p√°ginas espec√≠ficas
        document.addEventListener('DOMContentLoaded', function () {

            // Esperar a que el CartSidebar se inicialice
            setTimeout(() => {
                if (window.cartSidebar) {
                    window.cartSidebar.loadCartItems();
                } else if (window.refreshCart) {
                    window.refreshCart();
                }
            }, 500);

            // Tambi√©n actualizar cuando la p√°gina gana foco
            document.addEventListener('visibilitychange', function () {
                if (!document.hidden) {
                    setTimeout(() => {
                        if (window.cartSidebar) {
                            window.cartSidebar.loadCartItems();
                        } else if (window.refreshCart) {
                            window.refreshCart();
                        }
                    }, 100);
                }
            });
        });
    </script>

    <script th:src="@{/js/customer_header.js}"></script>
    <script th:src="@{/js/patterns-dictionary.js}"></script>
    <script th:src="@{/js/customer_profile.js}"></script>
    <script th:src="@{/js/customer_profile_validations.js}"></script>
</body>

</html>